var I=(w,t,s)=>{if(!t.has(w))throw TypeError("Cannot "+s)};var k=(w,t,s)=>{if(t.has(w))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(w):t.set(w,s)};var b=(w,t,s)=>(I(w,t,"access private method"),s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function s(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(i){if(i.ep)return;i.ep=!0;const n=s(i);fetch(i.href,n)}})();class a{constructor(t,s,o){this.x=t,this.y=s,this.z=o}subtract(t){return new a(this.x-t.x,this.y-t.y,this.z-t.z)}add(t){return new a(this.x+t.x,this.y+t.y,this.z+t.z)}toNormalizedVector(){return this.toVector().normalize()}toVector(){return new z(this.x,this.y,this.z)}move({dx:t=0,dy:s=0,dz:o=0}){this.x+=t,this.y+=s,this.z+=o}}class z{constructor(t,s,o){this.x=t,this.y=s,this.z=o}get norm(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}normalize(t=1){const s=this.norm;return new z(this.x&&this.x/s*t,this.y&&this.y/s*t,this.z&&this.z/s*t)}cross(t){return new z(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}toVertex3D(){return new a(this.x,this.y,this.z)}angle(t){return this.dot(t)/(this.norm*t.norm)}}class P{constructor(t,s){this.x=t,this.y=s}}class C{constructor(t,s){this.position=t,this.lookAt=s,this.calcMatrix()}_move({dx:t=0,dy:s=0,dz:o=0}){this.position.x+=t,this.position.y+=s,this.position.z+=o}move(t){return this._move(t),this.calcMatrix(),this}_moveLookAt({dx:t=0,dy:s=0,dz:o=0}){this.lookAt.x+=t,this.lookAt.y+=s,this.lookAt.z+=o}moveLookAt(t){return this._moveLookAt(t),this.calcMatrix(),this}moveDirection(t,s){const o=this.lookAt.subtract(this.position).toNormalizedVector(),i=new z(0,1,0),n=o.cross(i).normalize();this._move({dx:o.x*t+n.x*s,dy:o.y*t+n.y*s,dz:o.z*t+n.z*s}),this._moveLookAt({dx:o.x*t+n.x*s,dy:o.y*t+n.y*s,dz:o.z*t+n.z*s}),this.calcMatrix()}rotate(t,s){const o=Math.cos(t),i=Math.sin(t),n=Math.cos(s),r=Math.sin(s),c=this.lookAt.x-this.position.x,e=this.lookAt.y-this.position.y,u=this.lookAt.z-this.position.z;return this.lookAt.x=o*c-i*n*u+i*r*e+this.position.x,this.lookAt.z=i*c+o*n*u-o*r*e+this.position.z,this.lookAt.y=r*u+n*e+this.position.y,this.calcMatrix(),this}project(t){const s=500/(t.z||1e-6);return new P(s*t.x,s*t.y)}transformVector(t,s){const o=s.x,i=s.y,n=s.z,r=1,c=[];for(let e=0;e<4;e++){const u=t[0][e],h=t[1][e],m=t[2][e],p=t[3][e],x=o*u+i*h+n*m+r*p;c.push(x)}return new a(c[0]/c[3],c[1]/c[3],c[2]/c[3])}calcMatrix(){const t=this.lookAt.subtract(this.position).toNormalizedVector(),s=new z(0,1,0),o=t.cross(s).normalize(),i=o.cross(t);this.matrix=[[o.x,i.x,t.x,0],[o.y,i.y,t.y,0],[o.z,i.z,t.z,0],[0,0,0,1]]}convertPosition(t){return this.transformVector(this.matrix,this.position.subtract(t))}}class y{constructor(t,s,o,i){this.v1=t,this.v2=s,this.v3=o,this.color=i}get normalVector(){const t=this.v2.subtract(this.v1).toVector(),s=this.v3.subtract(this.v2).toVector();return t.cross(s).normalize()}get center(){return new a((this.v1.x+this.v2.x+this.v3.x)/3,(this.v1.y+this.v2.y+this.v3.y)/3,(this.v1.z+this.v2.z+this.v3.z)/3)}}class L{constructor(t){this.faces=t}get center(){const t=this.faces.length,s=this.faces.map(o=>o.center).reduce(({x:o,y:i,z:n},r)=>({x:o+r.x,y:i+r.y,z:n+r.z}),{x:0,y:0,z:0});return new a(s.x/t,s.y/t,s.z/t)}get vertices(){return this.faces.map(t=>[t.v1,t.v2,t.v3]).flat()}move(t){return this.vertices.forEach(s=>s.move(t)),this}rotate(t,s,o=this.center){const i=Math.cos(t),n=Math.sin(t),r=Math.cos(s),c=Math.sin(s);this.vertices.forEach(e=>{const u=e.x-o.x,h=e.y-o.y,m=e.z-o.z;e.x=i*u-n*r*m+n*c*h+o.x,e.z=n*u+i*r*m-i*c*h+o.z,e.y=c*m+r*h+o.y})}}const d=class{constructor(w,t,s,o=1){this.a=o,this.r=Math.floor(w),this.g=Math.floor(t),this.b=Math.floor(s)}darken(w=1){return new d(Math.floor(this.r*w),Math.floor(this.g*w),Math.floor(this.b*w),this.a)}get value(){return`rgba(${this.r},${this.g},${this.b},${this.a})`}};let l=d;l.Red=new d(255,0,0);l.Green=new d(0,255,0);l.Blue=new d(0,0,255);l.Yellow=new d(255,255,0);l.Pink=new d(255,20,147);l.Orange=new d(255,99,71);l.Cyan=new d(0,255,255);l.Purple=new d(255,0,255);l.Black=new d(0,0,0);var v,A;class N{constructor(){k(this,v)}async load(t){const s=await fetch(t).then(o=>o.text());return this.convert(s)}convert(t){const{vertics:s,faces:o}=b(this,v,A).call(this,t);return o.map(i=>new y(new a(s[i[0]].x,s[i[0]].y,s[i[0]].z),new a(s[i[1]].x,s[i[1]].y,s[i[1]].z),new a(s[i[2]].x,s[i[2]].y,s[i[2]].z),l.Orange))}}v=new WeakSet,A=function(t){const s=t.split(`
`),o=[],i=[],n=/(.+);(.+);(.+);,/,r=/(.+);(.+),(.+),(.+),(.+);,/,c=/(.+);(.+),(.+),(.+);,/,e=s.length;let u=0;for(;!(u>e||s[u].includes("faces"));){const h=n.exec(s[u]);if(u++,!h)continue;const m=h[1],p=h[2],x=h[3];o.push({x:Number.parseFloat(m),y:Number.parseFloat(p),z:Number.parseFloat(x)})}for(;!(u>e);){let h=r.exec(s[u]);h||(h=c.exec(s[u])),u++,h&&(h[1].trim()==="4"?(i.push([Number.parseInt(h[2],10),Number.parseInt(h[3],10),Number.parseInt(h[4],10)]),i.push([Number.parseInt(h[4],10),Number.parseInt(h[5],10),Number.parseInt(h[2],10)])):h[1].trim()==="3"&&i.push([Number.parseInt(h[2],10),Number.parseInt(h[3],10),Number.parseInt(h[4],10)]))}return{vertics:o,faces:i}};class j{constructor(){const t=document.querySelector("canvas");this.context=t.getContext("2d"),this.width=t.width,this.height=t.height}clear(){this.context.clearRect(0,0,this.width,this.height)}draw(t,s,o,i,n){const r=this.width/2,c=this.height/2;this.context.beginPath(),this.context.moveTo(t.x+r,-t.y+c),this.context.lineTo(s.x+r,-s.y+c),this.context.lineTo(o.x+r,-o.y+c),this.context.closePath(),this.context.strokeStyle=(n==null?void 0:n.value)??i.value,this.context.stroke(),this.context.fillStyle=i.value,this.context.fill()}}class V{constructor(t,s,o,i={}){this.view=t,this.camera=s,this.objects=o,this.options=i}setOptions(t){this.options.adjustBrightness=t.adjustBrightness??this.options.adjustBrightness,this.options.drawStroke=t.drawStroke??this.options.drawStroke}render(){const t=this.objects.map(o=>o.faces.map(i=>new y(this.camera.convertPosition(i.v1),this.camera.convertPosition(i.v2),this.camera.convertPosition(i.v3),i.color))).flat(),s=new z(100,100,-100);this.view.clear(),t.sort((o,i)=>o.center.z-i.center.z).filter(o=>o.v1.z<0&&o.v2.z<0&&o.v3.z<0).filter(o=>o.center.toVector().angle(o.normalVector)<=0).forEach(o=>{const i=this.options.adjustBrightness?o.color.darken(1-(o.normalVector.angle(s)+1)/2):o.color;this.view.draw(this.camera.project(o.v1),this.camera.project(o.v2),this.camera.project(o.v3),i,this.options.drawStroke?l.Black:i)})}}class M extends L{constructor(t,s,o,i){const n=i/2,r=i/2,c=i/2,e={x:t,y:s,z:o},u=[new y(new a(e.x-n,e.y-r,e.z-c),new a(e.x+n,e.y-r,e.z-c),new a(e.x-n,e.y-r,e.z+c),l.Red),new y(new a(e.x+n,e.y-r,e.z-c),new a(e.x+n,e.y-r,e.z+c),new a(e.x-n,e.y-r,e.z+c),l.Red),new y(new a(e.x-n,e.y-r,e.z+c),new a(e.x+n,e.y-r,e.z+c),new a(e.x-n,e.y+r,e.z+c),l.Blue),new y(new a(e.x-n,e.y+r,e.z+c),new a(e.x+n,e.y-r,e.z+c),new a(e.x+n,e.y+r,e.z+c),l.Blue),new y(new a(e.x+n,e.y-r,e.z-c),new a(e.x+n,e.y+r,e.z-c),new a(e.x+n,e.y-r,e.z+c),l.Green),new y(new a(e.x+n,e.y+r,e.z-c),new a(e.x+n,e.y+r,e.z+c),new a(e.x+n,e.y-r,e.z+c),l.Green),new y(new a(e.x-n,e.y+r,e.z-c),new a(e.x-n,e.y+r,e.z+c),new a(e.x+n,e.y+r,e.z-c),l.Orange),new y(new a(e.x+n,e.y+r,e.z-c),new a(e.x-n,e.y+r,e.z+c),new a(e.x+n,e.y+r,e.z+c),l.Orange),new y(new a(e.x-n,e.y-r,e.z-c),new a(e.x-n,e.y-r,e.z+c),new a(e.x-n,e.y+r,e.z+c),l.Pink),new y(new a(e.x-n,e.y-r,e.z-c),new a(e.x-n,e.y+r,e.z+c),new a(e.x-n,e.y+r,e.z-c),l.Pink),new y(new a(e.x-n,e.y-r,e.z-c),new a(e.x-n,e.y+r,e.z-c),new a(e.x+n,e.y-r,e.z-c),l.Yellow),new y(new a(e.x+n,e.y-r,e.z-c),new a(e.x-n,e.y+r,e.z-c),new a(e.x+n,e.y+r,e.z-c),l.Yellow)];super(u)}}class g extends L{static async load(){const t=await new N().load("./Cup.x");return new g(t)}}async function B(){const w=document.getElementById("adjust-brightness"),t=document.getElementById("draw-stroke"),s=new C(new a(1,1,1),new a(0,0,2)),o=new M(0,0,1,.1),i=new M(0,0,3,.5),n=await g.load().then(x=>x.move({dy:-1,dz:3})),r=new j,c=new V(r,s,[n,o,i],{adjustBrightness:w.checked,drawStroke:t.checked});w.addEventListener("change",()=>c.setOptions({adjustBrightness:w.checked})),t.addEventListener("change",()=>c.setOptions({drawStroke:t.checked}));class e{constructor(){this.pressing=new Set,window.addEventListener("keydown",f=>{this.pressing.add(f.key.toLowerCase())}),window.addEventListener("keyup",f=>{this.pressing.delete(f.key.toLowerCase())})}}const u=new e;function h(){const x=u.pressing;x.has("ArrowUp".toLowerCase())&&s.rotate(0,Math.PI/180),x.has("ArrowDown".toLowerCase())&&s.rotate(0,Math.PI/-180),x.has("ArrowLeft".toLowerCase())&&s.rotate(Math.PI/-90,0),x.has("ArrowRight".toLowerCase())&&s.rotate(Math.PI/90,0),x.has("w".toLowerCase())&&s.moveDirection(.1,0),x.has("s".toLowerCase())&&s.moveDirection(-.1,0),x.has("a".toLowerCase())&&s.moveDirection(0,-.1),x.has("d".toLowerCase())&&s.moveDirection(0,.1),x.has(" ".toLowerCase())&&s.move({dy:.1}).moveLookAt({dy:.1}),x.has("Shift".toLowerCase())&&s.move({dy:-.1}).moveLookAt({dy:-.1}),setTimeout(h,1e3/30)}setTimeout(h,1e3/30);function m(){n.rotate(Math.PI/360,Math.PI/360),setTimeout(m,1e3/30)}setTimeout(m,1e3/30);function p(){c.render(),requestAnimationFrame(p)}requestAnimationFrame(p)}B();
