var Y=(c,t,e)=>{if(!t.has(c))throw TypeError("Cannot "+e)};var R=(c,t,e)=>{if(t.has(c))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(c):t.set(c,e)};var S=(c,t,e)=>(Y(c,t,"access private method"),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function e(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(o){if(o.ep)return;o.ep=!0;const r=e(o);fetch(o.href,r)}})();class h{constructor(t,e,n){this.x=t,this.y=e,this.z=n}subtract(t){return new h(this.x-t.x,this.y-t.y,this.z-t.z)}add(t){return new h(this.x+t.x,this.y+t.y,this.z+t.z)}toNormalizedVector(){return this.toVector().normalize()}toVector(){return new v(this.x,this.y,this.z)}move({dx:t=0,dy:e=0,dz:n=0}){this.x+=t,this.y+=e,this.z+=n}}class v{constructor(t,e,n){this.x=t,this.y=e,this.z=n}get norm(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}normalize(t=1){const e=this.norm;return new v(this.x&&this.x/e*t,this.y&&this.y/e*t,this.z&&this.z/e*t)}cross(t){return new v(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}toVertex3D(){return new h(this.x,this.y,this.z)}angle(t){return this.dot(t)/(this.norm*t.norm)}}class A{constructor(t,e){this.x=t,this.y=e}}class ${constructor(t,e){this.position=t,this.lookAt=e,this.calcMatrix()}_move({dx:t=0,dy:e=0,dz:n=0}){this.position.x+=t,this.position.y+=e,this.position.z+=n}move(t){return this._move(t),this.calcMatrix(),this}_moveLookAt({dx:t=0,dy:e=0,dz:n=0}){this.lookAt.x+=t,this.lookAt.y+=e,this.lookAt.z+=n}moveLookAt(t){return this._moveLookAt(t),this.calcMatrix(),this}setLookAt({x:t,y:e,z:n}){return this.lookAt.x=t,this.lookAt.y=e,this.lookAt.z=n,this.calcMatrix(),this}moveDirection(t,e){const n=this.lookAt.subtract(this.position).toNormalizedVector(),o=new v(0,1,0),r=n.cross(o).normalize();this._move({dx:n.x*t+r.x*e,dy:n.y*t+r.y*e,dz:n.z*t+r.z*e}),this._moveLookAt({dx:n.x*t+r.x*e,dy:n.y*t+r.y*e,dz:n.z*t+r.z*e}),this.calcMatrix()}rotate(t,e){const n=Math.cos(t),o=Math.sin(t),r=Math.cos(e),i=Math.sin(e),a=this.lookAt.x-this.position.x,s=this.lookAt.y-this.position.y,l=this.lookAt.z-this.position.z;return this.lookAt.x=n*a-o*r*l+o*i*s+this.position.x,this.lookAt.z=o*a+n*r*l-n*i*s+this.position.z,this.lookAt.y=i*l+r*s+this.position.y,this.calcMatrix(),this}getVerticalAngle(){const t=this.lookAt.subtract(this.position).toNormalizedVector(),e=new v(0,1,0),n=t.cross(e).normalize();return e.cross(n).normalize().angle(t)}getHorizontalAngle(){const t=this.lookAt.subtract(this.position).toNormalizedVector(),e=new v(0,1,0),n=t.cross(e).normalize(),o=e.cross(n).normalize(),r=new v(1,0,0);return o.angle(r)}project(t){const e=500/(t.z||1e-6);return new A(e*t.x,e*t.y)}transformVector(t,e){const n=e.x,o=e.y,r=e.z,i=1,a=[];for(let s=0;s<4;s++){const l=t[0][s],u=t[1][s],f=t[2][s],y=t[3][s],g=n*l+o*u+r*f+i*y;a.push(g)}return new h(a[0]/a[3],a[1]/a[3],a[2]/a[3])}calcMatrix(){const t=this.lookAt.subtract(this.position).toNormalizedVector(),e=new v(0,1,0),n=t.cross(e).normalize(),o=n.cross(t);this.matrix=[[n.x,o.x,t.x,0],[n.y,o.y,t.y,0],[n.z,o.z,t.z,0],[0,0,0,1]]}convertPosition(t){return this.transformVector(this.matrix,this.position.subtract(t))}}class d{constructor(t,e,n,o){this.v1=t,this.v2=e,this.v3=n,this.material=o}get normalVector(){const t=this.v2.subtract(this.v1).toVector(),e=this.v3.subtract(this.v2).toVector();return t.cross(e).normalize()}get center(){return new h((this.v1.x+this.v2.x+this.v3.x)/3,(this.v1.y+this.v2.y+this.v3.y)/3,(this.v1.z+this.v2.z+this.v3.z)/3)}}const k={move({dx:c=0,dy:t=0,dz:e=0}){return[[1,0,0,c],[0,1,0,t],[0,0,1,e],[0,0,0,1]]},rotateY(c){return[[Math.cos(c),0,Math.sin(c),0],[0,1,0,0],[-Math.sin(c),0,Math.cos(c),0],[0,0,0,1]]},transpose(c){const t=[];for(const e in c)for(const n in c[e])t[n]=t[n]??[],t[n][e]=c[e][n];return t},product(c,t){if(c[0].length!==t.length)throw Error("Not matched");const e=k.transpose(t);return c.map(n=>e.map(o=>n.reduce((r,i,a)=>r+i*o[a],0)))}};class L{constructor(t){this.faces=t}get center(){const t=this.faces.length,e=this.faces.map(n=>n.center).reduce(({x:n,y:o,z:r},i)=>({x:n+i.x,y:o+i.y,z:r+i.z}),{x:0,y:0,z:0});return new h(e.x/t,e.y/t,e.z/t)}get vertices(){return this.faces.map(t=>[t.v1,t.v2,t.v3]).flat()}move(t){return this.vertices.forEach(e=>e.move(t)),this}rotate(t,e,n=this.center){const o=k.move({dx:-n.x,dy:-n.y,dz:-n.z}),r=k.rotateY(t),i=k.move({dx:n.x,dy:n.y,dz:n.z}),a=k.product(o,r);k.product(a,i),this.vertices.forEach(s=>{const l=k.product(r,[[s.x],[s.y],[s.z],[1]]);s.x=l[0][0]/l[3][0],s.y=l[1][0]/l[3][0],s.z=l[2][0]/l[3][0]})}}class G{}const x=class extends G{constructor(c,t,e,n=1){super(),this.a=n,this.type="Color",this.r=Math.floor(c),this.g=Math.floor(t),this.b=Math.floor(e)}darken(c=1){return new x(Math.floor(this.r*c),Math.floor(this.g*c),Math.floor(this.b*c),this.a)}get value(){return`rgba(${this.r},${this.g},${this.b},${this.a})`}};let w=x;w.Red=new x(255,0,0);w.Green=new x(0,255,0);w.Blue=new x(0,0,255);w.Yellow=new x(255,255,0);w.Pink=new x(255,20,147);w.Orange=new x(255,99,71);w.Cyan=new x(0,255,255);w.Purple=new x(255,0,255);w.Black=new x(0,0,0);var j,U;class _{constructor(){R(this,j)}async load(t){const e=await fetch(t).then(n=>n.text());return this.convert(e)}convert(t){const{vertics:e,faces:n}=S(this,j,U).call(this,t);return n.map(o=>new d(new h(e[o[0]].x,e[o[0]].y,e[o[0]].z),new h(e[o[1]].x,e[o[1]].y,e[o[1]].z),new h(e[o[2]].x,e[o[2]].y,e[o[2]].z),w.Orange))}}j=new WeakSet,U=function(t){const e=t.split(`
`),n=[],o=[],r=/(.+);(.+);(.+);,/,i=/(.+);(.+),(.+),(.+),(.+);,/,a=/(.+);(.+),(.+),(.+);,/,s=e.length;let l=0;for(;!(l>s||e[l].includes("faces"));){const u=r.exec(e[l]);if(l++,!u)continue;const f=u[1],y=u[2],g=u[3];n.push({x:Number.parseFloat(f),y:Number.parseFloat(y),z:Number.parseFloat(g)})}for(;!(l>s);){let u=i.exec(e[l]);u||(u=a.exec(e[l])),l++,u&&(u[1].trim()==="4"?(o.push([Number.parseInt(u[2],10),Number.parseInt(u[3],10),Number.parseInt(u[4],10)]),o.push([Number.parseInt(u[4],10),Number.parseInt(u[5],10),Number.parseInt(u[2],10)])):u[1].trim()==="3"&&o.push([Number.parseInt(u[2],10),Number.parseInt(u[3],10),Number.parseInt(u[4],10)]))}return{vertics:n,faces:o}};function H([c,t,e],n,o){const r=I(n,o,c.x,c.y,t.x,t.y)<0,i=I(n,o,t.x,t.y,e.x,e.y)<0,a=I(n,o,e.x,e.y,c.x,c.y)<0;return r===i&&i===a}function I(c,t,e,n,o,r){return(c-o)*(n-r)-(e-o)*(t-r)}const V={identity(c){const t=new Array(c);for(let e=0;e<c;e++){t[e]=new Array(c);for(let n=0;n<c;n++)t[e][n]=e===n?1:0}return t},multiply(c,t){if(c[0].length!==t.length)throw new Error("Matrix dimensions do not match");const e=c.length,n=t[0].length,o=new Array(e);for(let r=0;r<e;r++){o[r]=new Array(n);for(let i=0;i<n;i++){let a=0;for(let s=0;s<t.length;s++)a+=c[r][s]*t[s][i];o[r][i]=a}}return o},inv(c){if(c.length!==c[0].length)throw new Error("Matrix is not square");const t=c.length,e=new Array(t),n=V.identity(t);for(let o=0;o<t;o++){e[o]=new Array(t);for(let r=0;r<t;r++)e[o][r]=c[o][r]}for(let o=0;o<t;o++){const r=e[o][o];if(r===0)throw new Error("Matrix is singular");for(let i=0;i<t;i++)e[o][i]/=r,n[o][i]/=r;for(let i=0;i<t;i++)if(i!==o){const a=e[i][o];for(let s=0;s<t;s++)e[i][s]-=a*e[o][s],n[i][s]-=a*n[o][s]}}return n}};function J(c,t){let e=[[c[0].x,c[1].x,c[2].x],[c[0].y,c[1].y,c[2].y],[1,1,1]],n=[[t[0].x,t[1].x,t[2].x],[t[0].y,t[1].y,t[2].y],[1,1,1]];const o=V.multiply(n,V.inv(e));return[o[0][0],o[1][0],o[0][1],o[1][1],o[0][2],o[1][2]]}function K(c,t){const e=document.createElement("canvas"),n=e.getContext("2d",{willReadFrequently:!0});function o(r,i,a,s){const l=s.map(p=>({x:Math.floor(p.x+c/2),y:Math.floor(-p.y+t/2)}));e.width=c,e.height=t,n.clearRect(0,0,e.width,e.height),n.setTransform(...J(i,l)),n.drawImage(r,0,0);const u=Math.min(...l.map(p=>p.y)),f=Math.max(...l.map(p=>p.y)),y=Math.min(...l.map(p=>p.x)),g=Math.max(...l.map(p=>p.x)),z=n.getImageData(0,0,e.width,e.height);for(let p=y;p<=g;p++)for(let M=u;M<=f;M++)p>=e.width||M>=e.height||H(l,p,M)||z.data.set([0,0,0,0],(p+M*z.width)*4);n.putImageData(z,0,0),a.drawImage(e,y,u,g-y,f-u,y,u,g-y,f-u)}return o}class X{constructor(){const t=document.querySelector("canvas");this.context=t.getContext("2d"),this.width=t.width,this.height=t.height,this.imageRenderer=K(this.width,this.height)}clear(){this.context.clearRect(0,0,this.width,this.height)}drawImage(t,e,n,o){this.imageRenderer(o.image,[o.v1,o.v2,o.v3],this.context,[t,e,n])}draw(t,e,n,o,r){const i=this.width/2,a=this.height/2;this.context.beginPath(),this.context.moveTo(t.x+i,-t.y+a),this.context.lineTo(e.x+i,-e.y+a),this.context.lineTo(n.x+i,-n.y+a),this.context.closePath(),this.context.strokeStyle=(r==null?void 0:r.value)??o.value,this.context.stroke(),this.context.fillStyle=o.value,this.context.fill()}}class Q{constructor(t,e,n,o={}){this.view=t,this.camera=e,this.objects=n,this.options=o}setOptions(t){this.options.adjustBrightness=t.adjustBrightness??this.options.adjustBrightness,this.options.drawStroke=t.drawStroke??this.options.drawStroke}setObjects(t){this.objects=t}render(){const t=this.objects.map(n=>n.faces.map(o=>new d(this.camera.convertPosition(o.v1),this.camera.convertPosition(o.v2),this.camera.convertPosition(o.v3),o.material))).flat(),e=new v(100,100,-100);this.view.clear(),t.sort((n,o)=>n.center.z-o.center.z).filter(n=>n.v1.z<0&&n.v2.z<0&&n.v3.z<0).filter(n=>n.center.toVector().angle(n.normalVector)<=0).forEach(n=>{if(n.material.type==="Color"){const o=n.material,r=this.options.adjustBrightness?o.darken(1-(n.normalVector.angle(e)+1)/2):o;this.view.draw(this.camera.project(n.v1),this.camera.project(n.v2),this.camera.project(n.v3),r,this.options.drawStroke?w.Black:r)}else{const o=n.material;this.view.drawImage(this.camera.project(n.v1),this.camera.project(n.v2),this.camera.project(n.v3),o)}})}}class D extends L{constructor(t,e,n,o){const r=o/2,i=o/2,a=o/2,s={x:t,y:e,z:n},l=[new d(new h(s.x-r,s.y-i,s.z-a),new h(s.x+r,s.y-i,s.z-a),new h(s.x-r,s.y-i,s.z+a),w.Red),new d(new h(s.x+r,s.y-i,s.z-a),new h(s.x+r,s.y-i,s.z+a),new h(s.x-r,s.y-i,s.z+a),w.Red),new d(new h(s.x-r,s.y-i,s.z+a),new h(s.x+r,s.y-i,s.z+a),new h(s.x-r,s.y+i,s.z+a),w.Blue),new d(new h(s.x-r,s.y+i,s.z+a),new h(s.x+r,s.y-i,s.z+a),new h(s.x+r,s.y+i,s.z+a),w.Blue),new d(new h(s.x+r,s.y-i,s.z-a),new h(s.x+r,s.y+i,s.z-a),new h(s.x+r,s.y-i,s.z+a),w.Green),new d(new h(s.x+r,s.y+i,s.z-a),new h(s.x+r,s.y+i,s.z+a),new h(s.x+r,s.y-i,s.z+a),w.Green),new d(new h(s.x-r,s.y+i,s.z-a),new h(s.x-r,s.y+i,s.z+a),new h(s.x+r,s.y+i,s.z-a),w.Orange),new d(new h(s.x+r,s.y+i,s.z-a),new h(s.x-r,s.y+i,s.z+a),new h(s.x+r,s.y+i,s.z+a),w.Orange),new d(new h(s.x-r,s.y-i,s.z-a),new h(s.x-r,s.y-i,s.z+a),new h(s.x-r,s.y+i,s.z+a),w.Pink),new d(new h(s.x-r,s.y-i,s.z-a),new h(s.x-r,s.y+i,s.z+a),new h(s.x-r,s.y+i,s.z-a),w.Pink),new d(new h(s.x-r,s.y-i,s.z-a),new h(s.x-r,s.y+i,s.z-a),new h(s.x+r,s.y-i,s.z-a),w.Yellow),new d(new h(s.x+r,s.y-i,s.z-a),new h(s.x-r,s.y+i,s.z-a),new h(s.x+r,s.y+i,s.z-a),w.Yellow)];super(l)}}class F extends L{static async load(){const t=await new _().load("./Cup.x");return new F(t)}}class N extends L{static load(t,e,n,o){return new N([new d(new h(t,0,e),new h(t+n,0,e+o),new h(t+n,0,e),w.Yellow),new d(new h(t,0,e),new h(t,0,e+o),new h(t+n,0,e+o),w.Green)])}}class q extends G{constructor(t,e,n,o){super(),this.image=t,this.v1=e,this.v2=n,this.v3=o,this.type="Texture"}}function T(c){const t=new Image;return new Promise(e=>{t.src=c,t.onload=()=>e(t)})}class P extends L{static async load(t,e,n,o){const r=await T("./texture.jpg");return await T("./texture2.jpg"),new P([new d(new h(t,0,e),new h(t+n,0,e+o),new h(t+n,0,e),new q(r,new A(1,1),new A(1023,1024),new A(1024,1))),new d(new h(t,0,e),new h(t,0,e+o),new h(t+n,0,e+o),new q(r,new A(1,1),new A(1,1024),new A(1024,1023)))])}}class Z{static async load(t){const e=await fetch(t).then(r=>r.text());return new tt(e).groups()[0].faces.map(r=>new d(new h(r.v1.x,r.v1.y,r.v1.z),new h(r.v2.x,r.v2.y,r.v2.z),new h(r.v3.x,r.v3.y,r.v3.z),w.Green))}}class tt{constructor(t){this.values=t.split(`
`).map(e=>e.trim()).filter(e=>!e.startsWith("#")).filter(Boolean)}mtllib(){return{name:this.find(this.values,"mtllib")??void 0}}groups(){const t=[];let e=[];for(let n=0;n<this.values.length;n++){const o=this.values[n];o.startsWith("g")&&(e=[],t.push(e)),e.push(o)}return t.map(n=>n.join(`
`)).map(n=>this.parseGroup(n))}find(t,e){return t.find(n=>n.startsWith(e)).replace(e,"").trim()}filter(t,e){return t.filter(n=>n.startsWith(e)).map(n=>n.replace(e,"")).map(n=>n.trim())}parseFace(t){const e=t.split("/").map(n=>parseInt(n));return e.length===1?{v:e[0]}:e.length===2?{v:e[0],vt:e[1]}:{v:e[0],vt:e[1]?e[1]:void 0,vn:e[2]}}parseGroup(t){const e=t.split(`
`),n=this.find(e,"g"),o=this.filter(e,"v").map(a=>a.split(" ")).map(a=>a.map(s=>Number.parseFloat(s))).map(([a,s,l])=>({x:a,y:s,z:l}));this.filter(e,"vn").map(a=>a.split(" ")).map(a=>a.map(s=>Number.parseFloat(s))).map(([a,s,l])=>({x:a,y:s,z:l})),this.filter(e,"vt").map(a=>a.split(" ")).map(a=>a.map(s=>Number.parseFloat(s))).map(([a,s,l])=>({x:a,y:s,z:l}));const r=[];let i=null;for(let a=0;a<e.length;a++){const s=e[a];if(s.startsWith("usemtl")){i=s.replace("usemtl","").trim();continue}if(!s.startsWith("f"))continue;const l=s.replace("f","").trim().split(" ").map(u=>this.parseFace(u));if(l.length===3)r.push({v1:{...o[l[0].v-1]},v2:{...o[l[1].v-1]},v3:{...o[l[2].v-1]},material:i??void 0});else if(l.length===4)r.push({v1:{...o[l[0].v-1]},v2:{...o[l[1].v-1]},v3:{...o[l[2].v-1]},material:i??void 0}),r.push({v1:{...o[l[0].v-1]},v2:{...o[l[2].v-1]},v3:{...o[l[3].v-1]},material:i??void 0});else throw Error("Face is must be 4 or 3 vertices.")}return{name:n,faces:r}}}class C extends L{static async load(){const t=await Z.load("./Van/Van.obj");return new C(t)}}async function et(){function c(m,b){return m.includes(b)?m.filter(W=>b!==W):[...m,b]}const t=document.getElementById("adjust-brightness"),e=document.getElementById("draw-stroke"),n=document.getElementById("object-selector");[...n==null?void 0:n.querySelectorAll("input")].forEach(m=>{m.addEventListener("change",()=>{y=c(y,f[m.id]),z.setObjects(y)})});const o=new $(new h(5,5,5),new h(0,0,0)),r=new D(0,0,1,.1),i=new D(0,0,3,.5),a=await C.load().then(m=>m.move({dy:0,dz:-5})),s=await F.load().then(m=>m.move({dy:-1,dz:3})),l=await P.load(0,0,5,5),u=N.load(0,0,5,5),f={box1:r,box2:i,car:a,cup:s,plane1:l,plane2:u};let y=[];const g=new X,z=new Q(g,o,y,{adjustBrightness:t.checked,drawStroke:e.checked});t.addEventListener("change",()=>z.setOptions({adjustBrightness:t.checked})),e.addEventListener("change",()=>z.setOptions({drawStroke:e.checked}));class p{constructor(){this.pressing=new Set,window.addEventListener("keydown",b=>{this.pressing.add(b.key.toLowerCase())}),window.addEventListener("keyup",b=>{this.pressing.delete(b.key.toLowerCase())})}}const M=new p;function E(){const m=M.pressing;m.has("ArrowUp".toLowerCase())&&o.rotate(0,Math.PI/180),m.has("ArrowDown".toLowerCase())&&o.rotate(0,Math.PI/-180),m.has("ArrowLeft".toLowerCase())&&o.rotate(Math.PI/-90,0),m.has("ArrowRight".toLowerCase())&&o.rotate(Math.PI/90,0),m.has("w".toLowerCase())&&o.moveDirection(.3,0),m.has("s".toLowerCase())&&o.moveDirection(-.3,0),m.has("a".toLowerCase())&&o.moveDirection(0,-.3),m.has("d".toLowerCase())&&o.moveDirection(0,.3),m.has(" ".toLowerCase())&&o.move({dy:.3}).moveLookAt({dy:.3}),m.has("Shift".toLowerCase())&&o.move({dy:-.3}).moveLookAt({dy:-.3}),requestAnimationFrame(E)}requestAnimationFrame(E);function O(){s.rotate(Math.PI/90,Math.PI/180),setTimeout(O,1e3/30)}setTimeout(O,1e3/30);function B(){z.render(),requestAnimationFrame(B)}requestAnimationFrame(B)}et();
