var D=(c,t,e)=>{if(!t.has(c))throw TypeError("Cannot "+e)};var F=(c,t,e)=>{if(t.has(c))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(c):t.set(c,e)};var N=(c,t,e)=>(D(c,t,"access private method"),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function e(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(o){if(o.ep)return;o.ep=!0;const r=e(o);fetch(o.href,r)}})();class h{constructor(t,e,n){this.x=t,this.y=e,this.z=n}subtract(t){return new h(this.x-t.x,this.y-t.y,this.z-t.z)}add(t){return new h(this.x+t.x,this.y+t.y,this.z+t.z)}toNormalizedVector(){return this.toVector().normalize()}toVector(){return new g(this.x,this.y,this.z)}move({dx:t=0,dy:e=0,dz:n=0}){this.x+=t,this.y+=e,this.z+=n}}class g{constructor(t,e,n){this.x=t,this.y=e,this.z=n}get norm(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}normalize(t=1){const e=this.norm;return new g(this.x&&this.x/e*t,this.y&&this.y/e*t,this.z&&this.z/e*t)}cross(t){return new g(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}toVertex3D(){return new h(this.x,this.y,this.z)}angle(t){return this.dot(t)/(this.norm*t.norm)}}class q{constructor(t,e){this.x=t,this.y=e}}class ${constructor(t,e){this.position=t,this.lookAt=e,this.calcMatrix()}_move({dx:t=0,dy:e=0,dz:n=0}){this.position.x+=t,this.position.y+=e,this.position.z+=n}move(t){return this._move(t),this.calcMatrix(),this}_moveLookAt({dx:t=0,dy:e=0,dz:n=0}){this.lookAt.x+=t,this.lookAt.y+=e,this.lookAt.z+=n}moveLookAt(t){return this._moveLookAt(t),this.calcMatrix(),this}setLookAt({x:t,y:e,z:n}){return this.lookAt.x=t,this.lookAt.y=e,this.lookAt.z=n,this.calcMatrix(),this}moveDirection(t,e){const n=this.lookAt.subtract(this.position).toNormalizedVector(),o=new g(0,1,0),r=n.cross(o).normalize();this._move({dx:n.x*t+r.x*e,dy:n.y*t+r.y*e,dz:n.z*t+r.z*e}),this._moveLookAt({dx:n.x*t+r.x*e,dy:n.y*t+r.y*e,dz:n.z*t+r.z*e}),this.calcMatrix()}rotate(t,e){const n=Math.cos(t),o=Math.sin(t),r=Math.cos(e),a=Math.sin(e),i=this.lookAt.x-this.position.x,s=this.lookAt.y-this.position.y,l=this.lookAt.z-this.position.z;return this.lookAt.x=n*i-o*r*l+o*a*s+this.position.x,this.lookAt.z=o*i+n*r*l-n*a*s+this.position.z,this.lookAt.y=a*l+r*s+this.position.y,this.calcMatrix(),this}project(t){const e=500/(t.z||1e-6);return new q(e*t.x,e*t.y)}transformVector(t,e){const n=e.x,o=e.y,r=e.z,a=1,i=[];for(let s=0;s<4;s++){const l=t[0][s],u=t[1][s],d=t[2][s],v=t[3][s],w=n*l+o*u+r*d+a*v;i.push(w)}return new h(i[0]/i[3],i[1]/i[3],i[2]/i[3])}calcMatrix(){const t=this.lookAt.subtract(this.position).toNormalizedVector(),e=new g(0,1,0),n=t.cross(e).normalize(),o=n.cross(t);this.matrix=[[n.x,o.x,t.x,0],[n.y,o.y,t.y,0],[n.z,o.z,t.z,0],[0,0,0,1]]}convertPosition(t){return this.transformVector(this.matrix,this.position.subtract(t))}}class y{constructor(t,e,n,o){this.v1=t,this.v2=e,this.v3=n,this.material=o}get normalVector(){const t=this.v2.subtract(this.v1).toVector(),e=this.v3.subtract(this.v2).toVector();return t.cross(e).normalize()}get center(){return new h((this.v1.x+this.v2.x+this.v3.x)/3,(this.v1.y+this.v2.y+this.v3.y)/3,(this.v1.z+this.v2.z+this.v3.z)/3)}}const z={move({dx:c=0,dy:t=0,dz:e=0}){return[[1,0,0,c],[0,1,0,t],[0,0,1,e],[0,0,0,1]]},rotateY(c){return[[Math.cos(c),0,Math.sin(c),0],[0,1,0,0],[-Math.sin(c),0,Math.cos(c),0],[0,0,0,1]]},transpose(c){const t=[];for(const e in c)for(const n in c[e])t[n]=t[n]??[],t[n][e]=c[e][n];return t},product(c,t){if(c[0].length!==t.length)throw Error("Not matched");const e=z.transpose(t);return c.map(n=>e.map(o=>n.reduce((r,a,i)=>r+a*o[i],0)))}};class k{constructor(t){this.faces=t}get center(){const t=this.faces.length,e=this.faces.map(n=>n.center).reduce(({x:n,y:o,z:r},a)=>({x:n+a.x,y:o+a.y,z:r+a.z}),{x:0,y:0,z:0});return new h(e.x/t,e.y/t,e.z/t)}get vertices(){return this.faces.map(t=>[t.v1,t.v2,t.v3]).flat()}move(t){return this.vertices.forEach(e=>e.move(t)),this}rotate(t,e,n=this.center){const o=z.move({dx:-n.x,dy:-n.y,dz:-n.z}),r=z.rotateY(t),a=z.move({dx:n.x,dy:n.y,dz:n.z}),i=z.product(o,r);z.product(i,a),this.vertices.forEach(s=>{const l=z.product(r,[[s.x],[s.y],[s.z],[1]]);s.x=l[0][0]/l[3][0],s.y=l[1][0]/l[3][0],s.z=l[2][0]/l[3][0]})}}class G{}const x=class extends G{constructor(c,t,e,n=1){super(),this.a=n,this.type="Color",this.r=Math.floor(c),this.g=Math.floor(t),this.b=Math.floor(e)}darken(c=1){return new x(Math.floor(this.r*c),Math.floor(this.g*c),Math.floor(this.b*c),this.a)}get value(){return`rgba(${this.r},${this.g},${this.b},${this.a})`}};let m=x;m.Red=new x(255,0,0);m.Green=new x(0,255,0);m.Blue=new x(0,0,255);m.Yellow=new x(255,255,0);m.Pink=new x(255,20,147);m.Orange=new x(255,99,71);m.Cyan=new x(0,255,255);m.Purple=new x(255,0,255);m.Black=new x(0,0,0);var b,V;class T{constructor(){F(this,b)}async load(t){const e=await fetch(t).then(n=>n.text());return this.convert(e)}convert(t){const{vertics:e,faces:n}=N(this,b,V).call(this,t);return n.map(o=>new y(new h(e[o[0]].x,e[o[0]].y,e[o[0]].z),new h(e[o[1]].x,e[o[1]].y,e[o[1]].z),new h(e[o[2]].x,e[o[2]].y,e[o[2]].z),m.Orange))}}b=new WeakSet,V=function(t){const e=t.split(`
`),n=[],o=[],r=/(.+);(.+);(.+);,/,a=/(.+);(.+),(.+),(.+),(.+);,/,i=/(.+);(.+),(.+),(.+);,/,s=e.length;let l=0;for(;!(l>s||e[l].includes("faces"));){const u=r.exec(e[l]);if(l++,!u)continue;const d=u[1],v=u[2],w=u[3];n.push({x:Number.parseFloat(d),y:Number.parseFloat(v),z:Number.parseFloat(w)})}for(;!(l>s);){let u=a.exec(e[l]);u||(u=i.exec(e[l])),l++,u&&(u[1].trim()==="4"?(o.push([Number.parseInt(u[2],10),Number.parseInt(u[3],10),Number.parseInt(u[4],10)]),o.push([Number.parseInt(u[4],10),Number.parseInt(u[5],10),Number.parseInt(u[2],10)])):u[1].trim()==="3"&&o.push([Number.parseInt(u[2],10),Number.parseInt(u[3],10),Number.parseInt(u[4],10)]))}return{vertics:n,faces:o}};function W([c,t,e],n,o){const r=A(n,o,c.x,c.y,t.x,t.y)<0,a=A(n,o,t.x,t.y,e.x,e.y)<0,i=A(n,o,e.x,e.y,c.x,c.y)<0;return r===a&&a===i}function A(c,t,e,n,o,r){return(c-o)*(n-r)-(e-o)*(t-r)}const L={identity(c){const t=new Array(c);for(let e=0;e<c;e++){t[e]=new Array(c);for(let n=0;n<c;n++)t[e][n]=e===n?1:0}return t},multiply(c,t){if(c[0].length!==t.length)throw new Error("Matrix dimensions do not match");const e=c.length,n=t[0].length,o=new Array(e);for(let r=0;r<e;r++){o[r]=new Array(n);for(let a=0;a<n;a++){let i=0;for(let s=0;s<t.length;s++)i+=c[r][s]*t[s][a];o[r][a]=i}}return o},inv(c){if(c.length!==c[0].length)throw new Error("Matrix is not square");const t=c.length,e=new Array(t),n=L.identity(t);for(let o=0;o<t;o++){e[o]=new Array(t);for(let r=0;r<t;r++)e[o][r]=c[o][r]}for(let o=0;o<t;o++){const r=e[o][o];if(r===0)throw new Error("Matrix is singular");for(let a=0;a<t;a++)e[o][a]/=r,n[o][a]/=r;for(let a=0;a<t;a++)if(a!==o){const i=e[a][o];for(let s=0;s<t;s++)e[a][s]-=i*e[o][s],n[a][s]-=i*n[o][s]}}return n}};function Y(c,t){let e=[[c[0].x,c[1].x,c[2].x],[c[0].y,c[1].y,c[2].y],[1,1,1]],n=[[t[0].x,t[1].x,t[2].x],[t[0].y,t[1].y,t[2].y],[1,1,1]];const o=L.multiply(n,L.inv(e));return[o[0][0],o[1][0],o[0][1],o[1][1],o[0][2],o[1][2]]}function U(c,t,e,n){return`rgba(${c},${t},${e},${n})`}function _(c,t){const e=document.createElement("canvas"),n=e.getContext("2d",{willReadFrequently:!0});function o(r,a,i,s){const l=s.map(p=>({x:Math.floor(p.x+c/2),y:Math.floor(-p.y+t/2)}));e.width=c,e.height=t,n.setTransform(...Y(a,l)),n.drawImage(r,0,0);const u=Math.min(...l.map(p=>p.y)),d=Math.max(...l.map(p=>p.y)),v=Math.min(...l.map(p=>p.x)),w=Math.max(...l.map(p=>p.x)),f=n.getImageData(0,0,e.width,e.height);for(let p=v;p<=w;p++)for(let M=u;M<=d;M++)if(W(l,p,M)){const[E,B,O,S]=f.data.slice((p+M*f.width)*4,(p+M*f.width)*4+4),R=U(E,B,O,S);i.fillStyle=R,i.fillRect(p,M,1,1)}}return o}class J{constructor(){const t=document.querySelector("canvas");this.context=t.getContext("2d"),this.width=t.width,this.height=t.height,this.imageRenderer=_(this.width,this.height)}clear(){this.context.clearRect(0,0,this.width,this.height)}drawImage(t,e,n,o){this.imageRenderer(o.image,[o.v1,o.v2,o.v3],this.context,[t,e,n])}draw(t,e,n,o,r){const a=this.width/2,i=this.height/2;this.context.beginPath(),this.context.moveTo(t.x+a,-t.y+i),this.context.lineTo(e.x+a,-e.y+i),this.context.lineTo(n.x+a,-n.y+i),this.context.closePath(),this.context.strokeStyle=(r==null?void 0:r.value)??o.value,this.context.stroke(),this.context.fillStyle=o.value,this.context.fill()}}class K{constructor(t,e,n,o={}){this.view=t,this.camera=e,this.objects=n,this.options=o}setOptions(t){this.options.adjustBrightness=t.adjustBrightness??this.options.adjustBrightness,this.options.drawStroke=t.drawStroke??this.options.drawStroke}render(){const t=this.objects.map(n=>n.faces.map(o=>new y(this.camera.convertPosition(o.v1),this.camera.convertPosition(o.v2),this.camera.convertPosition(o.v3),o.material))).flat(),e=new g(100,100,-100);this.view.clear(),t.sort((n,o)=>n.center.z-o.center.z).filter(n=>n.v1.z<0&&n.v2.z<0&&n.v3.z<0).filter(n=>n.center.toVector().angle(n.normalVector)<=0).forEach(n=>{if(n.material.type==="Color"){const o=n.material,r=this.options.adjustBrightness?o.darken(1-(n.normalVector.angle(e)+1)/2):o;this.view.draw(this.camera.project(n.v1),this.camera.project(n.v2),this.camera.project(n.v3),r,this.options.drawStroke?m.Black:r)}else{const o=n.material;this.view.drawImage(this.camera.project(n.v1),this.camera.project(n.v2),this.camera.project(n.v3),o)}})}}class C extends k{constructor(t,e,n,o){const r=o/2,a=o/2,i=o/2,s={x:t,y:e,z:n},l=[new y(new h(s.x-r,s.y-a,s.z-i),new h(s.x+r,s.y-a,s.z-i),new h(s.x-r,s.y-a,s.z+i),m.Red),new y(new h(s.x+r,s.y-a,s.z-i),new h(s.x+r,s.y-a,s.z+i),new h(s.x-r,s.y-a,s.z+i),m.Red),new y(new h(s.x-r,s.y-a,s.z+i),new h(s.x+r,s.y-a,s.z+i),new h(s.x-r,s.y+a,s.z+i),m.Blue),new y(new h(s.x-r,s.y+a,s.z+i),new h(s.x+r,s.y-a,s.z+i),new h(s.x+r,s.y+a,s.z+i),m.Blue),new y(new h(s.x+r,s.y-a,s.z-i),new h(s.x+r,s.y+a,s.z-i),new h(s.x+r,s.y-a,s.z+i),m.Green),new y(new h(s.x+r,s.y+a,s.z-i),new h(s.x+r,s.y+a,s.z+i),new h(s.x+r,s.y-a,s.z+i),m.Green),new y(new h(s.x-r,s.y+a,s.z-i),new h(s.x-r,s.y+a,s.z+i),new h(s.x+r,s.y+a,s.z-i),m.Orange),new y(new h(s.x+r,s.y+a,s.z-i),new h(s.x-r,s.y+a,s.z+i),new h(s.x+r,s.y+a,s.z+i),m.Orange),new y(new h(s.x-r,s.y-a,s.z-i),new h(s.x-r,s.y-a,s.z+i),new h(s.x-r,s.y+a,s.z+i),m.Pink),new y(new h(s.x-r,s.y-a,s.z-i),new h(s.x-r,s.y+a,s.z+i),new h(s.x-r,s.y+a,s.z-i),m.Pink),new y(new h(s.x-r,s.y-a,s.z-i),new h(s.x-r,s.y+a,s.z-i),new h(s.x+r,s.y-a,s.z-i),m.Yellow),new y(new h(s.x+r,s.y-a,s.z-i),new h(s.x-r,s.y+a,s.z-i),new h(s.x+r,s.y+a,s.z-i),m.Yellow)];super(l)}}class j extends k{static async load(){const t=await new T().load("./Cup.x");return new j(t)}}function X(){const c=new Image;return new Promise(t=>{c.src="./texture.jpg",c.onload=()=>t(c)})}class I extends k{static async load(t,e,n,o){return await X(),new I([new y(new h(t,0,e),new h(t+n,0,e+o),new h(t+n,0,e),m.Yellow),new y(new h(t,0,e),new h(t,0,e+o),new h(t+n,0,e+o),m.Green)])}}class H{static async load(t){const e=await fetch(t).then(r=>r.text());return new Q(e).groups()[0].faces.map(r=>new y(new h(r.v1.x,r.v1.y,r.v1.z),new h(r.v2.x,r.v2.y,r.v2.z),new h(r.v3.x,r.v3.y,r.v3.z),m.Green))}}class Q{constructor(t){this.values=t.split(`
`).map(e=>e.trim()).filter(e=>!e.startsWith("#")).filter(Boolean)}mtllib(){return{name:this.find(this.values,"mtllib")??void 0}}groups(){const t=[];let e=[];for(let n=0;n<this.values.length;n++){const o=this.values[n];o.startsWith("g")&&(e=[],t.push(e)),e.push(o)}return t.map(n=>n.join(`
`)).map(n=>this.parseGroup(n))}find(t,e){return t.find(n=>n.startsWith(e)).replace(e,"").trim()}filter(t,e){return t.filter(n=>n.startsWith(e)).map(n=>n.replace(e,"")).map(n=>n.trim())}parseFace(t){const e=t.split("/").map(n=>parseInt(n));return e.length===1?{v:e[0]}:e.length===2?{v:e[0],vt:e[1]}:{v:e[0],vt:e[1]?e[1]:void 0,vn:e[2]}}parseGroup(t){const e=t.split(`
`),n=this.find(e,"g"),o=this.filter(e,"v").map(i=>i.split(" ")).map(i=>i.map(s=>Number.parseFloat(s))).map(([i,s,l])=>({x:i,y:s,z:l}));this.filter(e,"vn").map(i=>i.split(" ")).map(i=>i.map(s=>Number.parseFloat(s))).map(([i,s,l])=>({x:i,y:s,z:l})),this.filter(e,"vt").map(i=>i.split(" ")).map(i=>i.map(s=>Number.parseFloat(s))).map(([i,s,l])=>({x:i,y:s,z:l}));const r=[];let a=null;for(let i=0;i<e.length;i++){const s=e[i];if(s.startsWith("usemtl")){a=s.replace("usemtl","").trim();continue}if(!s.startsWith("f"))continue;const l=s.replace("f","").trim().split(" ").map(u=>this.parseFace(u));if(l.length===3)r.push({v1:{...o[l[0].v-1]},v2:{...o[l[1].v-1]},v3:{...o[l[2].v-1]},material:a??void 0});else if(l.length===4)r.push({v1:{...o[l[0].v-1]},v2:{...o[l[1].v-1]},v3:{...o[l[2].v-1]},material:a??void 0}),r.push({v1:{...o[l[0].v-1]},v2:{...o[l[2].v-1]},v3:{...o[l[3].v-1]},material:a??void 0});else throw Error("Face is must be 4 or 3 vertices.")}return{name:n,faces:r}}}class P extends k{static async load(){const t=await H.load("./Van/Van.obj");return new P(t)}}async function Z(){const c=document.getElementById("adjust-brightness"),t=document.getElementById("draw-stroke"),e=new $(new h(5,5,5),new h(0,0,0)),n=new C(0,0,1,.1);new C(0,0,3,.5);const o=await j.load().then(w=>w.move({dy:-1,dz:3}));await P.load().then(w=>w.move({dy:0,dz:-5}));const r=await I.load(0,0,5,5),a=new J,i=new K(a,e,[n,r],{adjustBrightness:c.checked,drawStroke:t.checked});c.addEventListener("change",()=>i.setOptions({adjustBrightness:c.checked})),t.addEventListener("change",()=>i.setOptions({drawStroke:t.checked}));class s{constructor(){this.pressing=new Set,window.addEventListener("keydown",f=>{this.pressing.add(f.key.toLowerCase())}),window.addEventListener("keyup",f=>{this.pressing.delete(f.key.toLowerCase())})}}const l=new s;function u(){const w=l.pressing;w.has("ArrowUp".toLowerCase())&&e.rotate(0,Math.PI/180),w.has("ArrowDown".toLowerCase())&&e.rotate(0,Math.PI/-180),w.has("ArrowLeft".toLowerCase())&&e.rotate(Math.PI/-90,0),w.has("ArrowRight".toLowerCase())&&e.rotate(Math.PI/90,0),w.has("w".toLowerCase())&&e.moveDirection(.3,0),w.has("s".toLowerCase())&&e.moveDirection(-.3,0),w.has("a".toLowerCase())&&e.moveDirection(0,-.3),w.has("d".toLowerCase())&&e.moveDirection(0,.3),w.has(" ".toLowerCase())&&e.move({dy:.3}).moveLookAt({dy:.3}),w.has("Shift".toLowerCase())&&e.move({dy:-.3}).moveLookAt({dy:-.3}),e.setLookAt(r.center),requestAnimationFrame(u)}requestAnimationFrame(u);function d(){o.rotate(Math.PI/90,Math.PI/180),setTimeout(d,1e3/30)}setTimeout(d,1e3/30);function v(){i.render(),requestAnimationFrame(v)}requestAnimationFrame(v)}Z();
