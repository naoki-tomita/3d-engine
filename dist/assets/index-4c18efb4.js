var I=(u,t,s)=>{if(!t.has(u))throw TypeError("Cannot "+s)};var k=(u,t,s)=>{if(t.has(u))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(u):t.set(u,s)};var M=(u,t,s)=>(I(u,t,"access private method"),s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function s(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(r){if(r.ep)return;r.ep=!0;const n=s(r);fetch(r.href,n)}})();class c{constructor(t,s,o){this.x=t,this.y=s,this.z=o}subtract(t){return new c(this.x-t.x,this.y-t.y,this.z-t.z)}add(t){return new c(this.x+t.x,this.y+t.y,this.z+t.z)}toNormalizedVector(){return this.toVector().normalize()}toVector(){return new v(this.x,this.y,this.z)}move({dx:t=0,dy:s=0,dz:o=0}){this.x+=t,this.y+=s,this.z+=o}}class v{constructor(t,s,o){this.x=t,this.y=s,this.z=o}get norm(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}normalize(t=1){const s=this.norm;return new v(this.x&&this.x/s*t,this.y&&this.y/s*t,this.z&&this.z/s*t)}cross(t){return new v(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}toVertex3D(){return new c(this.x,this.y,this.z)}angle(t){return this.dot(t)/(this.norm*t.norm)}}class N{constructor(t,s){this.x=t,this.y=s}}class P{constructor(t,s){this.position=t,this.lookAt=s,this.calcMatrix()}_move({dx:t=0,dy:s=0,dz:o=0}){this.position.x+=t,this.position.y+=s,this.position.z+=o}move(t){return this._move(t),this.calcMatrix(),this}_moveLookAt({dx:t=0,dy:s=0,dz:o=0}){this.lookAt.x+=t,this.lookAt.y+=s,this.lookAt.z+=o}moveLookAt(t){return this._moveLookAt(t),this.calcMatrix(),this}moveDirection(t,s){const o=this.lookAt.subtract(this.position).toNormalizedVector(),r=new v(0,1,0),n=o.cross(r).normalize();this._move({dx:o.x*t+n.x*s,dy:o.y*t+n.y*s,dz:o.z*t+n.z*s}),this._moveLookAt({dx:o.x*t+n.x*s,dy:o.y*t+n.y*s,dz:o.z*t+n.z*s}),this.calcMatrix()}rotate(t,s){const o=Math.cos(t),r=Math.sin(t),n=Math.cos(s),a=Math.sin(s),i=this.lookAt.x-this.position.x,e=this.lookAt.y-this.position.y,h=this.lookAt.z-this.position.z;return this.lookAt.x=o*i-r*n*h+r*a*e+this.position.x,this.lookAt.z=r*i+o*n*h-o*a*e+this.position.z,this.lookAt.y=a*h+n*e+this.position.y,this.calcMatrix(),this}project(t){const s=500/(t.z||1e-6);return new N(s*t.x,s*t.y)}transformVector(t,s){const o=s.x,r=s.y,n=s.z,a=1,i=[];for(let e=0;e<4;e++){const h=t[0][e],l=t[1][e],d=t[2][e],m=t[3][e],y=o*h+r*l+n*d+a*m;i.push(y)}return new c(i[0]/i[3],i[1]/i[3],i[2]/i[3])}calcMatrix(){const t=this.lookAt.subtract(this.position).toNormalizedVector(),s=new v(0,1,0),o=t.cross(s).normalize(),r=o.cross(t);this.matrix=[[o.x,r.x,t.x,0],[o.y,r.y,t.y,0],[o.z,r.z,t.z,0],[0,0,0,1]]}convertPosition(t){return this.transformVector(this.matrix,this.position.subtract(t))}}class p{constructor(t,s,o,r){this.v1=t,this.v2=s,this.v3=o,this.color=r}get normalVector(){const t=this.v2.subtract(this.v1).toVector(),s=this.v3.subtract(this.v2).toVector();return t.cross(s).normalize()}get center(){return new c((this.v1.x+this.v2.x+this.v3.x)/3,(this.v1.y+this.v2.y+this.v3.y)/3,(this.v1.z+this.v2.z+this.v3.z)/3)}}class f{constructor(t){this.faces=t}get center(){const t=this.faces.length,s=this.faces.map(o=>o.center).reduce(({x:o,y:r,z:n},a)=>({x:o+a.x,y:r+a.y,z:n+a.z}),{x:0,y:0,z:0});return new c(s.x/t,s.y/t,s.z/t)}get vertices(){return this.faces.map(t=>[t.v1,t.v2,t.v3]).flat()}move(t){return this.vertices.forEach(s=>s.move(t)),this}rotate(t,s,o=this.center){const r=Math.cos(t),n=Math.sin(t),a=Math.cos(s),i=Math.sin(s);this.vertices.forEach(e=>{const h=e.x-o.x,l=e.y-o.y,d=e.z-o.z;e.x=r*h-n*a*d+n*i*l+o.x,e.z=n*h+r*a*d-r*i*l+o.z,e.y=i*d+a*l+o.y})}}const x=class{constructor(u,t,s,o=1){this.a=o,this.r=Math.floor(u),this.g=Math.floor(t),this.b=Math.floor(s)}darken(u=1){return new x(Math.floor(this.r*u),Math.floor(this.g*u),Math.floor(this.b*u),this.a)}get value(){return`rgba(${this.r},${this.g},${this.b},${this.a})`}};let w=x;w.Red=new x(255,0,0);w.Green=new x(0,255,0);w.Blue=new x(0,0,255);w.Yellow=new x(255,255,0);w.Pink=new x(255,20,147);w.Orange=new x(255,99,71);w.Cyan=new x(0,255,255);w.Purple=new x(255,0,255);w.Black=new x(0,0,0);var z,A;class j{constructor(){k(this,z)}async load(t){const s=await fetch(t).then(o=>o.text());return this.convert(s)}convert(t){const{vertics:s,faces:o}=M(this,z,A).call(this,t);return o.map(r=>new p(new c(s[r[0]].x,s[r[0]].y,s[r[0]].z),new c(s[r[1]].x,s[r[1]].y,s[r[1]].z),new c(s[r[2]].x,s[r[2]].y,s[r[2]].z),w.Orange))}}z=new WeakSet,A=function(t){const s=t.split(`
`),o=[],r=[],n=/(.+);(.+);(.+);,/,a=/(.+);(.+),(.+),(.+),(.+);,/,i=/(.+);(.+),(.+),(.+);,/,e=s.length;let h=0;for(;!(h>e||s[h].includes("faces"));){const l=n.exec(s[h]);if(h++,!l)continue;const d=l[1],m=l[2],y=l[3];o.push({x:Number.parseFloat(d),y:Number.parseFloat(m),z:Number.parseFloat(y)})}for(;!(h>e);){let l=a.exec(s[h]);l||(l=i.exec(s[h])),h++,l&&(l[1].trim()==="4"?(r.push([Number.parseInt(l[2],10),Number.parseInt(l[3],10),Number.parseInt(l[4],10)]),r.push([Number.parseInt(l[4],10),Number.parseInt(l[5],10),Number.parseInt(l[2],10)])):l[1].trim()==="3"&&r.push([Number.parseInt(l[2],10),Number.parseInt(l[3],10),Number.parseInt(l[4],10)]))}return{vertics:o,faces:r}};class F{constructor(){const t=document.querySelector("canvas");this.context=t.getContext("2d"),this.width=t.width,this.height=t.height}clear(){this.context.clearRect(0,0,this.width,this.height)}draw(t,s,o,r,n){const a=this.width/2,i=this.height/2;this.context.beginPath(),this.context.moveTo(t.x+a,-t.y+i),this.context.lineTo(s.x+a,-s.y+i),this.context.lineTo(o.x+a,-o.y+i),this.context.closePath(),this.context.strokeStyle=(n==null?void 0:n.value)??r.value,this.context.stroke(),this.context.fillStyle=r.value,this.context.fill()}}class C{constructor(t,s,o,r={}){this.view=t,this.camera=s,this.objects=o,this.options=r}setOptions(t){this.options.adjustBrightness=t.adjustBrightness??this.options.adjustBrightness,this.options.drawStroke=t.drawStroke??this.options.drawStroke}render(){const t=this.objects.map(o=>o.faces.map(r=>new p(this.camera.convertPosition(r.v1),this.camera.convertPosition(r.v2),this.camera.convertPosition(r.v3),r.color))).flat(),s=new v(100,100,-100);this.view.clear(),t.sort((o,r)=>o.center.z-r.center.z).filter(o=>o.v1.z<0&&o.v2.z<0&&o.v3.z<0).filter(o=>o.center.toVector().angle(o.normalVector)<=0).forEach(o=>{const r=this.options.adjustBrightness?o.color.darken(1-(o.normalVector.angle(s)+1)/2):o.color;this.view.draw(this.camera.project(o.v1),this.camera.project(o.v2),this.camera.project(o.v3),r,this.options.drawStroke?w.Black:r)})}}class L extends f{constructor(t,s,o,r){const n=r/2,a=r/2,i=r/2,e={x:t,y:s,z:o},h=[new p(new c(e.x-n,e.y-a,e.z-i),new c(e.x+n,e.y-a,e.z-i),new c(e.x-n,e.y-a,e.z+i),w.Red),new p(new c(e.x+n,e.y-a,e.z-i),new c(e.x+n,e.y-a,e.z+i),new c(e.x-n,e.y-a,e.z+i),w.Red),new p(new c(e.x-n,e.y-a,e.z+i),new c(e.x+n,e.y-a,e.z+i),new c(e.x-n,e.y+a,e.z+i),w.Blue),new p(new c(e.x-n,e.y+a,e.z+i),new c(e.x+n,e.y-a,e.z+i),new c(e.x+n,e.y+a,e.z+i),w.Blue),new p(new c(e.x+n,e.y-a,e.z-i),new c(e.x+n,e.y+a,e.z-i),new c(e.x+n,e.y-a,e.z+i),w.Green),new p(new c(e.x+n,e.y+a,e.z-i),new c(e.x+n,e.y+a,e.z+i),new c(e.x+n,e.y-a,e.z+i),w.Green),new p(new c(e.x-n,e.y+a,e.z-i),new c(e.x-n,e.y+a,e.z+i),new c(e.x+n,e.y+a,e.z-i),w.Orange),new p(new c(e.x+n,e.y+a,e.z-i),new c(e.x-n,e.y+a,e.z+i),new c(e.x+n,e.y+a,e.z+i),w.Orange),new p(new c(e.x-n,e.y-a,e.z-i),new c(e.x-n,e.y-a,e.z+i),new c(e.x-n,e.y+a,e.z+i),w.Pink),new p(new c(e.x-n,e.y-a,e.z-i),new c(e.x-n,e.y+a,e.z+i),new c(e.x-n,e.y+a,e.z-i),w.Pink),new p(new c(e.x-n,e.y-a,e.z-i),new c(e.x-n,e.y+a,e.z-i),new c(e.x+n,e.y-a,e.z-i),w.Yellow),new p(new c(e.x+n,e.y-a,e.z-i),new c(e.x-n,e.y+a,e.z-i),new c(e.x+n,e.y+a,e.z-i),w.Yellow)];super(h)}}class g extends f{static async load(){const t=await new j().load("./Cup.x");return new g(t)}}class V{static async load(t){const s=await fetch(t).then(n=>n.text());return new B(s).groups()[0].faces.map(n=>new p(new c(n.v1.x,n.v1.y,n.v1.z),new c(n.v2.x,n.v2.y,n.v2.z),new c(n.v3.x,n.v3.y,n.v3.z),w.Green))}}class B{constructor(t){this.values=t.split(`
`).map(s=>s.trim()).filter(s=>!s.startsWith("#")).filter(Boolean)}mtllib(){return{name:this.find(this.values,"mtllib")??void 0}}groups(){const t=[];let s=[];for(let o=0;o<this.values.length;o++){const r=this.values[o];r.startsWith("g")&&(s=[],t.push(s)),s.push(r)}return t.map(o=>o.join(`
`)).map(o=>this.parseGroup(o))}find(t,s){return t.find(o=>o.startsWith(s)).replace(s,"").trim()}filter(t,s){return t.filter(o=>o.startsWith(s)).map(o=>o.replace(s,"")).map(o=>o.trim())}parseFace(t){const s=t.split("/").map(o=>parseInt(o));return s.length===1?{v:s[0]}:s.length===2?{v:s[0],vt:s[1]}:{v:s[0],vt:s[1]?s[1]:void 0,vn:s[2]}}parseGroup(t){const s=t.split(`
`),o=this.find(s,"g"),r=this.filter(s,"v").map(i=>i.split(" ")).map(i=>i.map(e=>Number.parseFloat(e))).map(([i,e,h])=>({x:i,y:e,z:h}));this.filter(s,"vn").map(i=>i.split(" ")).map(i=>i.map(e=>Number.parseFloat(e))).map(([i,e,h])=>({x:i,y:e,z:h})),this.filter(s,"vt").map(i=>i.split(" ")).map(i=>i.map(e=>Number.parseFloat(e))).map(([i,e,h])=>({x:i,y:e,z:h}));const n=[];let a=null;for(let i=0;i<s.length;i++){const e=s[i];if(e.startsWith("usemtl")){a=e.replace("usemtl","").trim();continue}if(!e.startsWith("f"))continue;const h=e.replace("f","").trim().split(" ").map(l=>this.parseFace(l));if(h.length===3)n.push({v1:{...r[h[0].v-1]},v2:{...r[h[1].v-1]},v3:{...r[h[2].v-1]},material:a??void 0});else if(h.length===4)n.push({v1:{...r[h[0].v-1]},v2:{...r[h[1].v-1]},v3:{...r[h[2].v-1]},material:a??void 0}),n.push({v1:{...r[h[0].v-1]},v2:{...r[h[2].v-1]},v3:{...r[h[3].v-1]},material:a??void 0});else throw Error("Face is must be 4 or 3 vertices.")}return{name:o,faces:n}}}class b extends f{static async load(){const t=await V.load("./Van/Van.obj");return new b(t)}}async function O(){const u=document.getElementById("adjust-brightness"),t=document.getElementById("draw-stroke"),s=new P(new c(40,40,40),new c(0,0,0));new L(0,0,1,.1),new L(0,0,3,.5);const o=await g.load().then(m=>m.move({dy:-1,dz:3})),r=await b.load().then(m=>m.move({dy:0,dz:-5})),n=new F,a=new C(n,s,[r],{adjustBrightness:u.checked,drawStroke:t.checked});u.addEventListener("change",()=>a.setOptions({adjustBrightness:u.checked})),t.addEventListener("change",()=>a.setOptions({drawStroke:t.checked}));class i{constructor(){this.pressing=new Set,window.addEventListener("keydown",y=>{this.pressing.add(y.key.toLowerCase())}),window.addEventListener("keyup",y=>{this.pressing.delete(y.key.toLowerCase())})}}const e=new i;function h(){const m=e.pressing;m.has("ArrowUp".toLowerCase())&&s.rotate(0,Math.PI/180),m.has("ArrowDown".toLowerCase())&&s.rotate(0,Math.PI/-180),m.has("ArrowLeft".toLowerCase())&&s.rotate(Math.PI/-90,0),m.has("ArrowRight".toLowerCase())&&s.rotate(Math.PI/90,0),m.has("w".toLowerCase())&&s.moveDirection(.1,0),m.has("s".toLowerCase())&&s.moveDirection(-.1,0),m.has("a".toLowerCase())&&s.moveDirection(0,-.1),m.has("d".toLowerCase())&&s.moveDirection(0,.1),m.has(" ".toLowerCase())&&s.move({dy:.1}).moveLookAt({dy:.1}),m.has("Shift".toLowerCase())&&s.move({dy:-.1}).moveLookAt({dy:-.1}),setTimeout(h,1e3/30)}setTimeout(h,1e3/30);function l(){o.rotate(Math.PI/360,Math.PI/360),setTimeout(l,1e3/30)}setTimeout(l,1e3/30);function d(){a.render(),requestAnimationFrame(d)}requestAnimationFrame(d)}O();
